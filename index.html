<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Калькулятор стоимости озвучки | Малютин Voice</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #1c1c1e;
      --text-color: #FFFCF2;
      --input-bg: #2c2c2e;
      --button-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --accent-color: #8b5cf6;
      --accent-light: #a78bfa;
      --radius: 12px;
      --radius-lg: 20px;
      --card-bg: rgba(44, 44, 46, 0.4);
      --card-border: rgba(255, 255, 255, 0.12);
      --card-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
    }

    .container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      position: relative;
    }

    /* Анимированный фон */
    .animated-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      opacity: 0.3;
      pointer-events: none;
    }

    .wave {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .wave path {
      stroke: #667eea;
      stroke-width: 1;
      fill: none;
      filter: drop-shadow(0 0 6px #764ba2);
      animation: waveGlow 3s ease-in-out infinite alternate;
    }

    @keyframes waveGlow {
      0% { stroke-opacity: 0.3; }
      100% { stroke-opacity: 1; }
    }

    /* Кнопка назад */
    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 12px 20px;
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      color: var(--text-color);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.25s ease;
      z-index: 100;
    }

    .back-btn:hover {
      background: var(--accent-color);
      transform: translateX(-3px);
    }

    /* Калькулятор */
    .calculator-wrapper {
      max-width: 600px;
      width: 100%;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: var(--radius-lg);
      box-shadow: var(--card-shadow);
      overflow: hidden;
      position: relative;
      z-index: 1;
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .calculator-header {
      padding: 32px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .calculator-header h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .calculator-header p {
      font-size: 0.95rem;
      opacity: 0.7;
      line-height: 1.5;
    }

    .calculator-body {
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      position: relative;
    }

    /* Drag and Drop */
    .drop-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(139, 92, 246, 0.95);
      backdrop-filter: blur(8px);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 10;
    }

    .drop-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .drop-content {
      text-align: center;
      animation: dropBounce 0.6s ease;
    }

    .drop-icon {
      font-size: 4rem;
      animation: floatIcon 0.8s ease-in-out infinite alternate;
      margin-bottom: 12px;
    }

    .drop-text {
      font-size: 1.2rem;
      font-weight: 600;
      color: #fff;
    }

    @keyframes dropBounce {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes floatIcon {
      from { transform: translateY(0); }
      to { transform: translateY(-8px); }
    }

    /* Input группа */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group label {
      font-size: 0.9rem;
      font-weight: 600;
      opacity: 0.9;
    }

    .input-with-icon {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    select, input[type="number"] {
      flex: 1;
      height: 52px;
      padding: 0 16px;
      border-radius: var(--radius);
      background: var(--input-bg);
      color: var(--text-color);
      border: 1.5px solid transparent;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s;
      appearance: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3Csvg fill='gray' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 20px;
      cursor: pointer;
    }

    select:focus, input[type="number"]:focus {
      border-color: var(--accent-color);
      outline: none;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    .file-icon {
      width: 52px;
      height: 52px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--input-bg);
      border-radius: var(--radius);
      cursor: pointer;
      flex-shrink: 0;
      transition: background 0.25s ease;
      font-size: 20px;
      position: relative;
    }

    .file-icon:hover {
      background: var(--accent-color);
    }

    .hidden {
      display: none !important;
    }

    .loader {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid var(--accent-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Tooltip */
    .tooltip-wrapper {
      position: relative;
    }

    .tooltip-bubble {
      position: absolute;
      top: 100%;
      margin-top: 8px;
      right: 0;
      background: var(--bg-color);
      color: var(--text-color);
      font-size: 13px;
      padding: 10px 14px;
      border-radius: var(--radius);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      z-index: 999;
      max-width: 260px;
      word-wrap: break-word;
      line-height: 1.45;
      text-align: left;
      white-space: normal;
      border: 1.5px solid var(--accent-color);
    }

    .tooltip-wrapper:hover .tooltip-bubble {
      opacity: 1;
    }

    /* Кнопка */
    .btn {
      width: 100%;
      padding: 14px 24px;
      font-family: 'Montserrat', sans-serif;
      font-size: 1.05rem;
      font-weight: 700;
      border-radius: var(--radius);
      background: var(--button-bg);
      color: var(--text-color);
      border: none;
      cursor: pointer;
      transition: all 0.25s ease;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s ease;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      filter: brightness(1.1);
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: scale(0.99);
    }

    /* Результат */
    .result-container {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 8px;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .result-container.fade-slide-in {
      opacity: 1;
      transform: translateY(0);
    }

    .result-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }

    .result-row:last-child {
      margin-bottom: 0;
    }

    .result-row .icon {
      font-size: 1.3rem;
      flex-shrink: 0;
    }

    .result-row .label {
      font-weight: 600;
      opacity: 0.8;
    }

    .result-row .value {
      margin-left: auto;
      font-weight: 700;
      color: var(--accent-light);
      text-align: right;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto;
    }

    /* Адаптация */
    @media (max-width: 768px) {
      .calculator-header h1 {
        font-size: 1.4rem;
      }

      .calculator-header {
        padding: 24px;
      }

      .calculator-body {
        padding: 24px;
      }

      .back-btn {
        top: 12px;
        left: 12px;
        padding: 10px 16px;
        font-size: 0.9rem;
      }

      .tooltip-bubble {
        max-width: 80vw;
      }
    }

    @media (max-width: 480px) {
      .calculator-header h1 {
        font-size: 1.2rem;
      }

      .calculator-body {
        padding: 20px;
        gap: 16px;
      }

      select, input[type="number"] {
        height: 48px;
        font-size: 0.95rem;
      }

      .file-icon {
        width: 48px;
        height: 48px;
      }

      .btn {
        font-size: 1rem;
        padding: 12px 20px;
      }

      .result-row {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="animated-bg">
    <svg class="wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
      <path d="M0,160L48,144C96,128,192,96,288,90.7C384,85,480,107,576,128C672,149,768,171,864,165.3C960,160,1056,128,1152,122.7C1248,117,1344,139,1392,149.3L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
    </svg>
  </div>

  <a href="/" class="back-btn">← Главная</a>

  <div class="container">
    <div class="calculator-wrapper">
      <div class="drop-overlay" id="dropOverlay">
        <div class="drop-content">
          <div class="drop-icon">📄</div>
          <div class="drop-text">Отпустите файл для загрузки</div>
        </div>
      </div>

      <div class="calculator-header">
        <h1>🎙️ Калькулятор стоимости озвучки</h1>
        <p>Загрузите файл или введите данные вручную для точного расчёта</p>
      </div>

      <div class="calculator-body">
        <div class="input-group">
          <label for="serviceSelect">Выберите услугу</label>
          <div class="input-with-icon">
            <select id="serviceSelect">
              <option value="voice_text">Озвучка текста</option>
              <option value="voice_video">Озвучка видео</option>
              <option value="translate_text">Перевод текста</option>
              <option value="translate_voice">Перевод + озвучка видео</option>
              <option value="voice_camera">Озвучка текста на камеру</option>
            </select>
            <div class="file-icon tooltip-wrapper">
              ❓
              <div id="tooltip" class="tooltip-bubble">Подсказка</div>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label for="manualInput">Количество</label>
          <div class="input-with-icon">
            <input type="number" id="manualInput" placeholder="Введите количество" />
            <div id="fileWrapper" class="file-icon tooltip-wrapper">
              <label id="fileLabel" for="fileInput" style="all: unset; cursor: pointer;">
                <span class="icon">📎</span>
                <span class="loader hidden"></span>
              </label>
              <div class="tooltip-bubble">Загрузите .txt или .docx</div>
            </div>
            <input type="file" id="fileInput" accept=".txt,.docx" style="display: none;" />
          </div>
        </div>

        <button class="btn" onclick="calculate()">Рассчитать стоимость</button>

        <div id="result"></div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script>
  let basePrice = 0;
  let urgent = false;
  
  const manualInput = document.getElementById('manualInput');
  const serviceSelect = document.getElementById('serviceSelect');
  const fileLabel = document.getElementById('fileLabel');
  const urgentBtn = document.getElementById('urgentBtn');
  const resultBlock = document.getElementById('result');
  const serviceTip = document.getElementById('serviceTip');

  manualInput.addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      calculate();
    }
  });

  const serviceTips = {
    "voice_text": "⚡ Загрузите txt или docx, или укажите точное количество слов для озвучки. Все числа, сокращения и единицы должны быть записаны полностью — так, как вы хотите, чтобы их произнесли. Например: 32 м - тридцать два метра",
    "voice_video": "⏱️ Длительность видео небходимо вводить с округлением в большую степень. 6 минут 3 секунды => 7 минут",
    "translate_text": "📚 Введите количество знаков без пробелов или перетяните сюда текстовый документ (txt, docx) для точного расчета.",
    "translate_voice": "🌐 Длительность видео небходимо вводить с округлением в большую степень. 6 минут 3 секунды => 7 минут",
    "voice_camera": "📹 Загрузите txt или docx, или укажите точное количество слов для озвучки. Все числа, сокращения и единицы должны быть записаны полностью — так, как вы хотите, чтобы их произнесли. Например: 120 км → сто двадцать километров."
  };
  
  // Обновление UI и сброс состояний
  function updateUI() {
    const allowFile = ['voice_text', 'translate_text', 'voice_camera'].includes(serviceSelect.value);
    const fileWrapper = document.getElementById("fileWrapper");
    fileWrapper.classList.toggle('hidden', !allowFile);
  
    const ph = {
      'voice_text': 'Введите количество слов',
      'voice_video': 'Введите длительность видео (минуты)',
      'translate_text': 'Введите количество знаков без пробелов',
      'translate_voice': 'Введите длительность видео (минуты)',
      'voice_camera': 'Введите количество слов'
    };
    manualInput.placeholder = ph[serviceSelect.value] || 'Введите вручную';
    document.getElementById("tooltip").textContent = serviceTips[serviceSelect.value] || "";

  
    urgent = false;
    basePrice = 0;
    urgentBtn.style.display = 'none';
    resultBlock.innerText = '';
    manualInput.value = '';
  }
  
  // --- Обработчики событий ---
  serviceSelect.addEventListener('change', updateUI);
  
  manualInput.addEventListener('input', () => {
    urgent = false;
    basePrice = 0;
    urgentBtn.style.display = 'none';
    resultBlock.innerText = '';
  });
  
  document.addEventListener("DOMContentLoaded", updateUI);
  
  // --- DRAG AND DROP ---

const dropZone = document.getElementById('dropZone');
let dragCounter = 0;

window.addEventListener('dragenter', (e) => {
  dragCounter++;
  dropZone.classList.add('active');
});

window.addEventListener('dragleave', (e) => {
  dragCounter--;
  if (dragCounter <= 0) {
    dropZone.classList.remove('active');
  }
});

window.addEventListener('dragover', (e) => {
  e.preventDefault();
});

window.addEventListener('drop', async (e) => {
  e.preventDefault();
  dragCounter = 0;
  dropZone.classList.remove('active');

  const file = e.dataTransfer.files[0];
  if (!file || !['text/plain', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'].includes(file.type)) {
    alert('Поддерживаются только .txt и .docx');
    return;
  }

  if (!['voice_text', 'translate_text', 'voice_camera'].includes(serviceSelect.value)) {
    serviceSelect.value = 'voice_text';
    updateUI();
  }

  document.getElementById('fileInput').files = e.dataTransfer.files;
  handleFile({ target: { files: e.dataTransfer.files } });
});

  // --- Обработка файла ---
  document.getElementById('fileInput').addEventListener('change', handleFile);
  
  function handleFile(e) {
    urgent = false;
    basePrice = 0;
    urgentBtn.style.display = 'none';
    resultBlock.innerText = '';
  
    const file = e.target.files[0];
    if (!file) return;
  
    const icon = fileLabel.querySelector('.icon');
    const loader = fileLabel.querySelector('.loader');
    icon.classList.add('hidden');
    loader.classList.remove('hidden');
  
    const done = async (text) => {
      try {
        const count = await countBackend(text);
        if (!isNaN(count) && count >= 1) {
          manualInput.value = count;
          calculate();  // ← автоматический запуск расчета
        } else {
          manualInput.value = 0;
          alert("Файл не содержит слов!");
        }
      } catch (err) {
        alert("Ошибка при подсчёте слов. Проверь файл.");
      } finally {
        icon.classList.remove('hidden');
        loader.classList.add('hidden');
      }
    };
  
    const fail = (msg) => {
      icon.classList.remove('hidden');
      loader.classList.add('hidden');
      alert(msg);
    };
  
    if (file.name.endsWith('.txt')) {
  const reader = new FileReader();

  reader.onload = function (event) {
    const text = event.target.result;
    const looksBroken = text.includes(" ") || text.length < 100;

    if (looksBroken) {
      const fallbackReader = new FileReader();
      fallbackReader.onload = function (e) {
        const recoveredText = e.target.result;
        setTimeout(() => done(recoveredText), 500 + Math.random() * 800);
      };
      fallbackReader.onerror = () => fail("Не удалось прочитать .txt файл (кодировка).");
      fallbackReader.readAsText(file, 'windows-1251');
    } else {
      setTimeout(() => done(text), 500 + Math.random() * 800);
    }
  };

  reader.onerror = () => fail("Не удалось прочитать .txt файл.");
  reader.readAsText(file);
}


    else if (file.name.endsWith('.docx')) {
      const reader = new FileReader();
      reader.onload = function (event) {
        mammoth.extractRawText({ arrayBuffer: event.target.result })
          .then(result => {
            const text = result.value || '';
            setTimeout(() => done(text), 500 + Math.random() * 800);
          })
          .catch(err => {
            fail("Не удалось извлечь текст из .docx файла.");
          });
      };
      reader.onerror = () => fail("Не удалось прочитать .docx файл.");
      reader.readAsArrayBuffer(file);
    } else {
      fail("Поддерживаются только файлы .txt и .docx");
    }
  }
  
  async function countBackend(text) {
  const service = serviceSelect.value;
  const url = service === 'translate_text'
    ? "http://127.0.0.1:8000/count_chars"
    : "http://127.0.0.1:8000/count_words";

  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text, service })  // 👈 вот это важно!
  });

  if (!response.ok) throw new Error("Ошибка сервера");

  const data = await response.json();
  return service === 'translate_text' ? data.chars : data.words;
}
  
  window.applyUrgent = function applyUrgent() {
    if (!basePrice) return;
    urgent = true;
    calculate();
  }
  
  async function calculate() {
    const service = serviceSelect.value;
    let value = parseInt(manualInput.value) || 0;
  
    if (!value || value <= 0) {
      resultBlock.innerText = "Введите корректное значение.";
      return;
    }
  
    // Анимация расчёта
    resultBlock.innerHTML = `<div class="spinner"></div>
      <div style="margin-top:12px;color:#888;">Считаем стоимость...</div>`;
  
    const payload = {
      service: service,
      text: value.toString(),
      is_urgent: urgent
    };
  
    try {
      const response = await fetch("http://127.0.0.1:8000/calculate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if (!response.ok) throw new Error("Ошибка сервера");
      const data = await response.json();
  
      function secondsToTime(sec) {
        const m = Math.floor(sec / 60);
        const s = Math.round(sec % 60);
        return `${m}:${s < 10 ? '0' : ''}${s}`;
      }
  
      let serviceTitle = {
        'voice_text': "Озвучка текста",
        'voice_video': "Озвучка видео",
        'translate_text': "Перевод текста",
        'translate_voice': "Перевод + озвучка видео",
        'voice_camera': "Озвучка текста на камеру"
      }[service] || "";
  
      let resultText = `<div class="result-container" style="font-size:18px; line-height:1.6; max-width:400px; margin:0 auto;">`;

// Услуга
resultText += `
  <div class="result-row">
    <div class="icon">📦</div>
    <div class="label">Услуга:</div>
    <div class="value">${serviceTitle}${urgent ? " (СРОЧНО)" : ""}</div>
  </div>
`;

// Слова / минуты / оптимальный хронометраж
if (service === 'voice_text' || service === 'voice_camera') {
  const words = data.word_count;
  const minutes = Math.ceil(words / 120);
  const optimal_time = secondsToTime(Math.round(words * 60 / 133));
  resultText += `
    <div class="result-row">
      <div class="icon">📄</div>
      <div class="label">Слов:</div>
      <div class="value">${words}</div>
    </div>
    <div class="result-row">
      <div class="icon">🕒</div>
      <div class="label">До:</div>
      <div class="value">${minutes} минут</div>
    </div>
    <div class="result-row">
      <div class="icon">🎯</div>
      <div class="label">Оптимальный хронометраж:</div>
      <div class="value">${optimal_time}</div>
    </div>
  `;
}

// Видео или перевод + озвучка видео — минуты
if (service === 'voice_video' || service === 'translate_voice') {
  resultText += `
    <div class="result-row">
      <div class="icon">🕒</div>
      <div class="label">До:</div>
      <div class="value">${value} минут</div>
    </div>
  `;
}

// Перевод текста — знаки
if (service === 'translate_text') {
  resultText += `
    <div class="result-row">
      <div class="icon">🔠</div>
      <div class="label">Знаков без пробелов:</div>
      <div class="value">${value}</div>
    </div>
  `;
}

// Срок выполнения
const deadline = urgent ? data.deadline_urgent : data.deadline;
const match = deadline.match(/^(.+?) \(до (.+?) включительно\)$/);

let daysOnly = '';
if (match?.[1]) {
  const num = parseInt(match[1]);
  if (!isNaN(num)) {
    daysOnly = num === 1 ? '1 день' : `до ${num} дней`;
  } else {
    daysOnly = `до ${match[1]}`;
  }
}

const dateOnly = match?.[2] || "";

resultText += `
  <div class="result-row">
    <div class="icon">⏰</div>
    <div class="label">Срок выполнения:</div>
    <div class="value">${daysOnly}</div>
  </div>
  <div class="result-row">
    <div class="icon">📅</div>
    <div class="label">Дедлайн:</div>
    <div class="value">${dateOnly}</div>
  </div>
`;

// Стоимость
resultText += `
  <div class="result-row">
    <div class="icon">💰</div>
    <div class="label">Стоимость:</div>
    <div class="value">${
      urgent
        ? `${data.price_rub.toLocaleString('ru-RU')} ₽ ➡️ ${data.price_rub_urgent.toLocaleString('ru-RU')} ₽`
        : `${data.price_rub.toLocaleString('ru-RU')} ₽`
    }</div>
  </div>
`;

// В USDT
resultText += `
  <div class="result-row">
    <div class="icon">💲</div>
    <div class="label">В USDT:</div>
    <div class="value">${
      urgent
        ? `${data.price_usdt} USDT ➡️ ${data.price_usdt_urgent} USDT`
        : `${data.price_usdt} USDT`
    }</div>
  </div>
`;

resultText += `</div>`;

setTimeout(() => {
  resultBlock.innerHTML = resultText;
  requestAnimationFrame(() => {
  const container = resultBlock.querySelector('.result-container');
  if (container) container.classList.add('fade-slide-in');
  });

  if (!urgent) {
    basePrice = data.price_rub;
    urgentBtn.style.display = 'block';
  } else {
    urgentBtn.style.display = 'none';
  }
}, 600 + Math.random() * 400);

} catch (error) {
  resultBlock.innerText = "Ошибка: " + error.message;
}
  }

</script>
</body>
</html>